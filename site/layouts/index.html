<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">

    <head>
        {{ partial "head/metadata.html" . }}
        {{ if .Site.Params.plausible }}{{ partial "head/plausible.html" . }}{{ end }}
        {{ partial "head/openGraph.html" . }}
        {{ partial "head/favicons.html" . }}
        {{ partial "head/css.html" . }}
        {{ partial "css/owlCarousel.html" . }}
    </head>

    <body>
        {{ with .Site.GetPage "/home" }}
        <section id="top" class="hero is-{{ .Site.Params.home.introHeight | default "fullheight" }}">
            <div class="hero-head"></div>
            <div class="hero-body">
                <div class="container has-text-centered">
                    <h1 class="bold-title">
                        <span class="typing-container">
                            <span class="typing-text">{{ .Title | markdownify }}</span>
                        </span>
                    </h1>
                    <div class="subtitle is-3">
                        <span class="typing-container">
                            <span class="typing-text typing-text-delay">Senior game engineer</span>
                        </span>
                    </div>
                </div>
            </div>
            {{ end }}

            <div class="scroll-arrow-wrap">
                <a href="#content-anchor" class="scroll-arrow" id="scroll-arrow" aria-label="Scroll down">
                    <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </a>
            </div>

        </section>

        {{/* Sticky tab bar - outside hero so sticky works */}}
        <div class="section-tabs" id="content-anchor">
            <div class="container">
                <div class="tabs-nav">
                    {{ with .Site.GetPage "/home" }}
                    {{ $home := . }}
                    {{ $pages := .Resources.ByType "page" }}
                    {{ with .Site.GetPage "/blog" }}
                        {{ $pages = $pages | append . }}
                    {{ end }}
                    {{ with .Site.GetPage "/projects" }}
                        {{ $pages = $pages | append . }}
                    {{ end }}
                    {{ range sort $pages "Params.weight" }}
                        {{ if .File }}
                        {{ $id := "" }}
                        {{ if eq (os.Stat .File.Dir).Name "projects" }}
                            {{ $id = "projects" }}
                        {{ else if eq (os.Stat .File.Dir).Name "blog" }}
                            {{ $id = "blog" }}
                        {{ else }}
                            {{ $id = .File.TranslationBaseName }}
                        {{ end }}
                        <a class="tab-link" href="#{{ $id }}" data-tab="{{ $id }}">
                            {{ .Title | markdownify }}
                        </a>
                        {{ end }}
                    {{ end }}
                    {{ end }}
                    <div class="tab-indicator"></div>
                </div>
            </div>
        </div>
        {{/* Tab content panels */}}
        <div class="tab-panels">
            {{ with .Site.GetPage "/home" }}
            {{ $home := . }}
            {{ $pages := .Resources.ByType "page" }}
            {{ with .Site.GetPage "/blog" }}
                {{ $pages = $pages | append . }}
            {{ end }}
            {{ with .Site.GetPage "/projects" }}
                {{ $pages = $pages | append . }}
            {{ end }}

            {{ range sort $pages "Params.weight" }}
            {{ if .File }}
            {{ if eq (os.Stat .File.Dir).Name "projects" }}
                <div class="tab-panel" data-panel="projects">
                    {{ partial "home/projects.html" . }}
                </div>
            {{ else if eq (os.Stat .File.Dir).Name "blog" }}
                <div class="tab-panel" data-panel="blog">
                    {{ partial "home/blog.html" . }}
                </div>
            {{ else }}
                <div class="tab-panel" data-panel="{{ .File.TranslationBaseName }}">
                    <div class="section" id="{{ .File.TranslationBaseName }}">
                        <div class="container">
                            <h2 class="title is-2 has-text-centered">{{ .Title | markdownify }}</h2>
                            {{ if .Params.Image }}
                            <div class="columns about-columns">
                                <div class="column is-one-third has-text-centered">
                                    {{ with $home.Resources.GetMatch .Params.Image }}
                                    {{ with .Resize "320x" }}
                                    <img class="img-responsive avatar" src="{{ .Permalink }}" alt="{{ .Name }}">
                                    {{ end }}
                                    {{ end }}
                                </div>
                                <div class="markdown column about-content">
                                    {{ .Content }}
                                </div>
                            </div>
                            {{ else }}
                            <div class="markdown has-text-centered">
                                {{ .Content }}
                            </div>
                            {{ end }}
                        </div>
                    </div>
                </div>
            {{ end }}
            {{ end }}
            {{ end }}
            {{ end }}
        </div>

        {{ partial "footer/text.html" . }}
        {{ partial "footer/scripts.html" . }}
        {{ partial "js/owlCarousel.html" . }}

        {{ if .Site.Params.home.localTime }}
        <script>
            function update_localtime() {
                const time = new Date().toLocaleTimeString('{{ .Site.Params.home.timeFormat }}', { timeZone: '{{ .Site.Params.home.timeZone }}', timeStyle: 'short' });
                document.getElementById('time').textContent = time;
            }
            update_localtime();
            setInterval(update_localtime, 1000);
        </script>
        {{ end }}

<style>
/* Tab navigation */
.section-tabs {
    padding: 0.75rem 0;
    position: sticky;
    top: 0;
    z-index: 100;
    background: #ffffff;
}

@media (prefers-color-scheme: dark) {
    .section-tabs {
        background: #222222;
    }
}

.tabs-nav {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0;
    position: relative;
}

.tab-link {
    padding: 0.75rem 1.5rem;
    font-size: 0.85rem;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: rgba(255, 255, 255, 0.5);
    text-decoration: none;
    transition: color 0.25s ease;
    position: relative;
    z-index: 1;
}

.tab-link:hover {
    color: rgba(255, 255, 255, 0.8);
}

.tab-link.is-active {
    color: #4fc3f7;
}

/* Animated underline indicator */
.tab-indicator {
    position: absolute;
    bottom: 0;
    height: 3px;
    background: #4fc3f7;
    border-radius: 2px;
    transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1), width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 0 8px rgba(79, 195, 247, 0.4);
}

/* Tab panels */
.tab-panels {
    position: relative;
    min-height: calc(100vh - 50px);
}

.tab-panel {
    display: none;
    opacity: 0;
    transform: translateY(12px);
    transition: opacity 0.35s ease, transform 0.35s ease;
}

.tab-panel.is-active {
    display: block;
    opacity: 1;
    transform: translateY(0);
}

/* Light theme overrides */
@media (prefers-color-scheme: light) {
    .tab-link {
        color: rgba(0, 0, 0, 0.4);
    }
    .tab-link:hover {
        color: rgba(0, 0, 0, 0.7);
    }
    .tab-link.is-active {
        color: #0288d1;
    }
    .tab-indicator {
        background: #0288d1;
        box-shadow: 0 0 8px rgba(2, 136, 209, 0.4);
    }
    .scroll-arrow {
        color: rgba(0, 0, 0, 0.3);
    }
    .scroll-arrow:hover {
        color: #0288d1;
    }
}

/* Scroll arrow */
.scroll-arrow-wrap {
    display: flex;
    justify-content: center;
    padding-bottom: 0.5rem;
}

.scroll-arrow {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: rgba(255, 255, 255, 0.4);
    transition: color 0.2s ease;
    animation: bounce 2s infinite;
    cursor: pointer;
}

.scroll-arrow:hover {
    color: #4fc3f7;
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(8px); }
    60% { transform: translateY(4px); }
}

/* About section: align content height with avatar */
.about-columns {
    align-items: stretch;
}

.about-columns .column.is-one-third {
    display: flex;
    align-items: center;
    justify-content: center;
}

.about-content {
    display: flex;
    flex-direction: column;
    justify-content: center;
}

@media screen and (max-width: 768px) {
    .tab-link {
        padding: 0.6rem 0.8rem;
        font-size: 0.75rem;
    }
}
</style>

<script>
(function() {
    var tabs = document.querySelectorAll('.tab-link');
    var panels = document.querySelectorAll('.tab-panel');
    var indicator = document.querySelector('.tab-indicator');

    function updateIndicator(tab) {
        if (!indicator) return;
        var nav = document.querySelector('.tabs-nav');
        var navRect = nav.getBoundingClientRect();
        var tabRect = tab.getBoundingClientRect();
        indicator.style.left = (tabRect.left - navRect.left) + 'px';
        indicator.style.width = tabRect.width + 'px';
    }

    function activateTab(tabId, pushState) {
        tabs.forEach(function(t) { t.classList.remove('is-active'); });
        panels.forEach(function(p) { p.classList.remove('is-active'); });

        var activeTab = document.querySelector('.tab-link[data-tab="' + tabId + '"]');
        var activePanel = document.querySelector('.tab-panel[data-panel="' + tabId + '"]');

        if (activeTab) {
            activeTab.classList.add('is-active');
            updateIndicator(activeTab);
        }
        if (activePanel) {
            activePanel.classList.add('is-active');
        }

        if (pushState) {
            history.replaceState(null, '', '#' + tabId);
        }
    }

    // Click handler
    tabs.forEach(function(tab) {
        tab.addEventListener('click', function(e) {
            e.preventDefault();
            activateTab(this.getAttribute('data-tab'), true);
            // Keep tab bar in view after switching to a shorter panel
            var sectionTabs = document.querySelector('.section-tabs');
            if (sectionTabs) {
                var rect = sectionTabs.getBoundingClientRect();
                if (rect.top < 0 || rect.top > 0) {
                    sectionTabs.scrollIntoView({ behavior: 'instant', block: 'start' });
                }
            }
        });
    });

    // Handle hash on load and back/forward
    function activateFromHash() {
        var hash = window.location.hash.replace('#', '');
        if (hash && document.querySelector('.tab-panel[data-panel="' + hash + '"]')) {
            activateTab(hash, false);
        } else if (tabs.length > 0) {
            activateTab(tabs[0].getAttribute('data-tab'), false);
        }
    }

    window.addEventListener('hashchange', activateFromHash);

    // Init
    requestAnimationFrame(function() {
        activateFromHash();
    });

    // Scroll arrow
    var arrow = document.getElementById('scroll-arrow');
    if (arrow) {
        arrow.addEventListener('click', function(e) {
            e.preventDefault();
            var target = document.getElementById('content-anchor');
            if (target) {
                target.scrollIntoView({ behavior: 'smooth' });
            }
        });
    }

    // Recalculate indicator on resize
    window.addEventListener('resize', function() {
        var active = document.querySelector('.tab-link.is-active');
        if (active) updateIndicator(active);
    });
})();
</script>
    </body>
</html>
